<?xml version="1.0" encoding="utf-8"?>
<DayEntry xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:newtelligence-com:dasblog:runtime:data">
  <Date>2007-06-08T02:00:00.0000000+02:00</Date>
  <Entries>
    <Entry>
      <Content>&lt;p&gt;&lt;a href="http://www.dasblog.info/" rel="previewlink"&gt;&lt;img style="float: right; margin-bottom: 1em; margin-left: 1em" alt="dasBlog Logo" src="http://www.therightstuff.de/content/binary/dasBlog-Logo.png"&gt;dasBlog&lt;/a&gt; has a pretty large user base, and while browsing some dasBlog sites I occassionally check if they're set up securely. It's not that dasBlog is inherently insecure, but some&amp;nbsp;installations allow for information leakage and most users aren't even aware of this.&lt;/p&gt; &lt;h3&gt;Basic setup&lt;/h3&gt; &lt;p&gt;There are a couple of locations where you can set up &lt;a href="http://www.asp101.com/articles/cynthia/authentication/default.asp" rel="previewlink"&gt;security for any ASP.NET application&lt;/a&gt;:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;NTFS security,  &lt;li&gt;IIS virtual directory and folder security,  &lt;li&gt;&lt;strong&gt;web.config&lt;/strong&gt; &lt;code&gt;&amp;lt;authentication&amp;gt;&lt;/code&gt; element or a&amp;nbsp;&lt;code&gt;&lt;a href="http://support.microsoft.com/kb/815152" rel="previewlink"&gt;HttpForbiddenHandler&lt;/a&gt;&lt;/code&gt; for certain ASP.NET file extensions.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Note that &lt;strong&gt;web.config&lt;/strong&gt; settings only apply to file extensions mapped to ASP.NET on Windows Server 2003 and before. I am working on IIS 6 here and&amp;nbsp;while I like my security settings in (mostly) one place&amp;nbsp;I usually&amp;nbsp;go with a generic read access configuration in IIS and set the more fine-grained settings using NTFS.&lt;/p&gt; &lt;p&gt;When deploying dasBlog to your web server you&amp;nbsp;will likely&amp;nbsp;enable read access to the dasBlog folder for the &lt;a href="http://support.microsoft.com/kb/815153" rel="previewlink"&gt;IUSR and NETWORK SERVICE accounts&lt;/a&gt; on the NTFS Security tab. This gives the&amp;nbsp;IIS and ASP.NET runtimes the rights&amp;nbsp;they need to work. On the &lt;strong&gt;/logs&lt;/strong&gt;, &lt;strong&gt;/content&lt;/strong&gt; and &lt;strong&gt;/SiteConfig&lt;/strong&gt; directories you will also need to enable change access for the NETWORK SERVICE account since this is where dasBlog stores its working data. (dasBlog is represented by the IIS worker process identity, which is NETWORK SERVICE on Windows Server 2003 and ASPNET on Windows&amp;nbsp;2000 and XP.) If anything is set up incorrectly you'll see the &lt;a href="http://www.therightstuff.de/SiteConfig/setuperror.html" rel="previewlink"&gt;configuration error page&lt;/a&gt; when you're trying configure your blog or post a blog entry.&lt;/p&gt; &lt;div&gt; &lt;table style="margin-left: auto; margin-right: auto" unselectable="on"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;Folder&lt;/th&gt; &lt;th&gt;IUSR access&lt;/th&gt; &lt;th&gt;NETWORK SERVICE access&lt;/th&gt; &lt;th&gt;Notes&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;/dasBlog root&lt;/td&gt; &lt;td&gt;R&lt;/td&gt; &lt;td&gt;R&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/bin&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;Contents protected by ASP.NET&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/content&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Blog posts, comments, trackbacks&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/binary&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI, WI&lt;/td&gt; &lt;td&gt;Binary content, i.e. images and enclosures&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/profiles&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI, WI&lt;/td&gt; &lt;td&gt;User profiles&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/DatePicker&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/ftb&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/images&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/logs&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Log files&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/SiteConfig&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Config and error pages&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/smilies&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/themes&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;Legend: R=Read, RI=Read (inherited), W=Write, WI=Write (inherited)&lt;/div&gt; &lt;h3&gt;The /logs folder&lt;/h3&gt; &lt;p&gt;Sometimes when I visit a random dasBlog&amp;nbsp;site I try to download one of dasBlog's log files which are located in the &lt;strong&gt;/logs&lt;/strong&gt; folder. Since IUSR's read access is most likely inherited (&lt;abbr title="Read access (inherited)"&gt;RI&lt;/abbr&gt;) in this folder, anonymous users can download log files.&amp;nbsp;The log file name format is publicy available so, for example, the &lt;strong&gt;/logs/2007-06-08-referrer.log.zip&lt;/strong&gt; file contains the referrers for today. This &lt;a href="http://en.wikipedia.org/wiki/Information_leakage" rel="previewlink"&gt;information leakage&lt;/a&gt; could be easily mitigated by denying IUSR read access to the &lt;strong&gt;/logs&lt;/strong&gt; folder. However, I've&amp;nbsp;found at least three high-traffic blogs where this was not the case (I e-mailed the owners, things are fixed now).&lt;/p&gt; &lt;h3&gt;Themes&lt;/h3&gt; &lt;p&gt;Another&amp;nbsp;problem that &lt;a href="http://sourceforge.net/mailarchive/forum.php?thread_name=003f01c7a81e%2455223960%24ff66ac20%24%40net&amp;amp;forum_name=dasblogce-developers" rel="previewlink"&gt;came up recently&amp;nbsp;on the developer mailing list&lt;/a&gt; was how to keep&amp;nbsp;&lt;a href="http://www.dasblog.info/ThemesAndMacros.aspx" rel="previewlink"&gt;blog templates&lt;/a&gt; private. Since we already incorporate the &lt;code&gt;&lt;a href="http://support.microsoft.com/kb/815152" rel="previewlink"&gt;HttpForbiddenHandler&lt;/a&gt;&lt;/code&gt; for&amp;nbsp;&lt;strong&gt;*.blogtemplate&lt;/strong&gt; files and &lt;a href="http://www.therightstuff.de/2005/10/23/IIS+And+Unknown+MIME+Types.aspx" rel="previewlink"&gt;IIS doesn't serve files when there's no MIME type available&lt;/a&gt; this is really a non-issue. The template's manifest file, however, will be served but that should not bother you since there's no&amp;nbsp;valuable information in it.&lt;/p&gt; &lt;h3&gt;Special Case: The /content folder&lt;/h3&gt; &lt;p&gt;One rather interesting place is the &lt;strong&gt;/content&lt;/strong&gt; folder. Your posts, comments and blogged binary content like images are stored there.&amp;nbsp;The &lt;strong&gt;/content/binary&lt;/strong&gt; subfolder holds images and enclosures, i.e. basically everything you attach to a certain post.&amp;nbsp;The &lt;strong&gt;/content/profiles&lt;/strong&gt; folder serves as a container for user profiles stored in&amp;nbsp;&lt;strong&gt;&amp;lt;Username&amp;gt;.format.html&lt;/strong&gt; files. Please note that&amp;nbsp;&lt;strong&gt;*.format.html&lt;/strong&gt; files are always templated and served through &lt;strong&gt;FormatPage.aspx&lt;/strong&gt;, that is, are never accessed by IUSR directly.&lt;/p&gt; &lt;p&gt;With the basic setup above, read access for anonymous users is enabled in the &lt;strong&gt;/content&lt;/strong&gt; folder and its subfolders. Thus, anonymous users are able to get the raw post data by&amp;nbsp;requesting the &lt;strong&gt;*.dayentry.xml&lt;/strong&gt; and &lt;strong&gt;*.dayfeedback.xml&lt;/strong&gt; files for a certain date, i.e. &lt;strong&gt;/content/2007-06-08.dayentry.xml&lt;/strong&gt;. Again, the file name pattern is no secret.&lt;/p&gt; &lt;p&gt;This last piece of public information should only be served through certain channels like the templated font page or RSS. Because of dasBlog's folder structure securing the &lt;strong&gt;/content&lt;/strong&gt; folder it is kind of tricky:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;First, deny read access to the &lt;strong&gt;/content&lt;/strong&gt; folder for the IUSR account.  &lt;li&gt;In the next step, open the security tab of the &lt;strong&gt;/content/binary&lt;/strong&gt; folder and break NTFS inheritance there copying all existing ACLs.  &lt;li&gt;Delete the Deny&amp;nbsp;ACL&amp;nbsp;for IUSR.&lt;/li&gt;&lt;/ul&gt; &lt;h3&gt;Secure Configuration&lt;/h3&gt; &lt;p&gt;In the end the NTFS security settings that work best for me look like this: (Changes red)&lt;/p&gt; &lt;div&gt; &lt;table style="margin-left: auto; margin-right: auto" unselectable="on"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;Folder&lt;/th&gt; &lt;th&gt;IUSR access&lt;/th&gt; &lt;th&gt;NETWORK SERVICE access&lt;/th&gt; &lt;th&gt;Notes&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;/dasBlog root&lt;/td&gt; &lt;td&gt;R&lt;/td&gt; &lt;td&gt;R&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/bin&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;Contents protected by ASP.NET&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/content&lt;/td&gt; &lt;td&gt;RI, &lt;span style="color: red"&gt;RD&lt;/span&gt;&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Blog posts, comments, trackbacks&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/binary&lt;/td&gt; &lt;td&gt;&lt;span style="color: red"&gt;R&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;span style="color: red"&gt;R, W&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt; &lt;td&gt;Binary content, i.e. images and enclosures&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/profiles&lt;/td&gt; &lt;td&gt;RI, &lt;span style="color: red"&gt;RDI&lt;/span&gt;&lt;/td&gt; &lt;td&gt;RI, WI&lt;/td&gt; &lt;td&gt;User profiles&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/DatePicker&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/ftb&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/images&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/logs&lt;/td&gt; &lt;td&gt;RI, &lt;span style="color: red"&gt;RD&lt;/span&gt;&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Log files&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/SiteConfig&lt;/td&gt; &lt;td&gt;RI, &lt;span style="color: red"&gt;RD&lt;/span&gt;&lt;/td&gt; &lt;td&gt;RI, W&lt;/td&gt; &lt;td&gt;Config and error pages&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/smilies&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;/themes&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;RI&lt;/td&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;Legend: R=Read, RI=Read (inherited), W=Write, WI=Write (inherited), RD=Deny read, RDI=Deny read (inherited)&lt;/div&gt; &lt;p&gt;Please note that on Windows Deny ACLs have always preference over Allow ACLs.&lt;/p&gt; &lt;h3&gt;Discuss&lt;/h3&gt; &lt;p&gt;If you're a dasBlog developer or user, please feel free to leave a comment if you (dis)like&amp;nbsp;this solution, have a question&amp;nbsp;or suggestions for a better solution.&lt;/p&gt; &lt;p class="now-playing"&gt;Now Playing [&lt;a title="Insert Now Playing Into Your Own Blog Posts" href="http://www.therightstuff.de/Projects/NowPlaying/" rel="previewlink"&gt;?&lt;/a&gt;]: Robert Mechs – The OGD Sessions Vol. 2&lt;/p&gt;</Content>
      <Created>2007-06-08T09:44:41.0000000+02:00</Created>
      <Modified>2007-06-08T16:08:42.4370746+02:00</Modified>
      <EntryId>26d93b1c-d7a4-4264-90ea-c5f55d4671e0</EntryId>
      <Description />
      <Title>How To Secure Your dasBlog Installation</Title>
      <Categories>dasBlog;Security</Categories>
      <Author>agross</Author>
      <IsPublic>true</IsPublic>
      <Syndicated>true</Syndicated>
      <ShowOnFrontPage>true</ShowOnFrontPage>
      <AllowComments>true</AllowComments>
      <Attachments />
      <Crossposts />
    </Entry>
  </Entries>
</DayEntry>