<?xml version="1.0" encoding="utf-8"?>
<DayEntry xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:newtelligence-com:dasblog:runtime:data">
  <Date>2007-04-06T02:00:00.0000000+02:00</Date>
  <Entries>
    <Entry>
      <Content>&lt;p&gt;In case you own a server that is located in your apartment or is hosted at a professional data center, you might find it interesting to know how the server's tasks and services affect the overall load. Load is what you pay for in regard to the hosting provider and it's desirable to have an eye on the server performance.&lt;/p&gt; &lt;p&gt;Of course you could&amp;nbsp;&lt;abbr title="Remote Desktop Protocol"&gt;&lt;/abbr&gt;&lt;a href="http://www.therightstuff.de/2006/11/21/Supporting+Users+Over+The+Internet+Overcoming+Firewalled+Networks.aspx" rel="previewlink"&gt;RDP into the server&lt;/a&gt; and start up the task manager or the performance monitor. However, this will only give you an impression of the current load. Perfmon is able to record statistics of various performance counters, but downloading the logs and analyzing them locally is quite a hassle. Also, you will have to repeatedly download and analyze logs in order to get an impression how the&amp;nbsp;counter values evolve over time.&lt;/p&gt; &lt;p&gt;What about a&amp;nbsp;easy solution that&amp;nbsp;leverages standards&amp;nbsp;and renders nice graphs? I use&amp;nbsp;&lt;abbr title="Multi Router Traffic Grapher"&gt;&lt;a href="http://oss.oetiker.ch/mrtg/" rel="previewlink"&gt;MRTG&lt;/a&gt;&lt;/abbr&gt; by &lt;a href="http://tobi.oetiker.ch/" rel="previewlink"&gt;Tobi Oetiker&lt;/a&gt; to monitor some performance counters of the (two) servers I'm in charge of.&amp;nbsp;MRTG, a&amp;nbsp;mature and free addition to the administrator's toolbox,&amp;nbsp;uses &lt;abbr title="Simple Network Management Protocol"&gt;&lt;a href="http://en.wikipedia.org/wiki/SNMP" rel="previewlink"&gt;SNMP&lt;/a&gt;&lt;/abbr&gt; and is able to generate graphs and web sites. Needless to say that MRTG is not targeted to replace advanced approaches to server management like &lt;a title="Microsoft System Management Server" href="http://www.microsoft.com/smserver/default.mspx" rel="previewlink"&gt;SMS&lt;/a&gt; or &lt;a title="Microsoft Operations Manager" href="http://www.microsoft.com/mom/default.mspx" rel="previewlink"&gt;MOM&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;In order to give you an impression what can be achieved with MRTG, take a look at the following screenshot of a web site. The&amp;nbsp;aggregated graphs you see show the activity of our home server over the last 24 hours.&lt;/p&gt; &lt;p align="center"&gt;&lt;a title="MRTG Aggregate View" href="http://www.therightstuff.de/content/binary/WindowsLiveWriter/MonitoringServers/MRTG.png" rel="lightbox[MRTG]"&gt;&lt;img alt="MRTG Aggregate View" src="http://www.therightstuff.de/content/binary/WindowsLiveWriter/MonitoringServers/MRTG-thumb.png"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;A&amp;nbsp;click on any of daily graphs reveal a detailed view depicting the values of the selected counter up to over the last year. See how memory consumption steadily rises?&lt;/p&gt; &lt;p align="center"&gt;&lt;a title="MRTG Detail View" href="http://www.therightstuff.de/content/binary/WindowsLiveWriter/MonitoringServers/MRTG-Detail.png" rel="lightbox[MRTG]"&gt;&lt;img alt="MRTG Detail View" src="http://www.therightstuff.de/content/binary/WindowsLiveWriter/MonitoringServers/MRTG-Detail-thumb.png"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;MRTG is also good for finding temporary problems with&amp;nbsp;server services. If you monitor HTTP connections and find that they come to a grinding halt, chances are that&amp;nbsp;the web server has been running into problems. Of course, an enterprise-ready server monitoring solution would have sent out a notification&amp;nbsp;about the problem in this case.&lt;/p&gt; &lt;p&gt;As said above, MRTG uses SNMP to get its data. However, finding the &lt;a title="SNMP MIBs for Windows 2000" href="http://wsman.msft.net/pub/w2kmibs/" rel="previewlink"&gt;right SNMP OIDs&lt;/a&gt; for the counters you're interested in can be a complicated task because of the hierarchical nature of&amp;nbsp;OIDs. MRTG can also run custom scripts (Batch, &lt;abbr title="Windows Scripting Host"&gt;WSH&lt;/abbr&gt;, &lt;a href="http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx" rel="previewlink"&gt;PowerShell&lt;/a&gt;, …) to acquire counter data, so you could query WMI (thus, also Windows performance counters), custom log files or any other data source. In this respect, MRTG is pretty powerful.&lt;/p&gt; &lt;p&gt;Data points are stored in log files that virtually newer grow because old data will be&amp;nbsp;coalesced&amp;nbsp;over time. The files take up about 55 KB for each counter on the machine above.&amp;nbsp;Of course, this results in less accuracy for data from weeks ago, but generating&amp;nbsp;10000-foot-level graphs from these values is perfectly okay.&lt;/p&gt; &lt;p&gt;One tenable drawback of MRTG is that it's only able to acquire data points in 5-minute intervals. To get a higher temporal resolution choose&amp;nbsp;&lt;a href="http://oss.oetiker.ch/rrdtool/" rel="previewlink"&gt;RRDtool&lt;/a&gt;&amp;nbsp;by the same author along &lt;a href="http://oss.oetiker.ch/rrdtool/rrdworld/index.en.html" rel="previewlink"&gt;with any supported application&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;In order to get you started with MRTG here are some useful links for installing MRTG on your server:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;&lt;a href="http://oss.oetiker.ch/mrtg/" rel="previewlink"&gt;MRTG home page&lt;/a&gt;  &lt;li&gt;&lt;a href="http://www.activestate.com/store/freedownload.aspx?prdGuid=81fbce82-6bd5-49bc-a915-08d58c2648ca" rel="previewlink"&gt;Perl&lt;/a&gt;, the only prerequisite  &lt;li&gt;&lt;a href="http://support.microsoft.com/default.aspx?scid=KB;EN-US;q315154&amp;amp;" rel="previewlink"&gt;How to configure SNMP on Windows&lt;/a&gt;  &lt;li&gt;&lt;a href="http://oss.oetiker.ch/mrtg/doc/mrtg-nt-guide.en.html" rel="previewlink"&gt;Setting up MRTG on Windows&lt;/a&gt;  &lt;li&gt;&lt;a href="http://oss.oetiker.ch/mrtg/doc/mrtg-reference.en.html" rel="previewlink"&gt;MRTG configuration file reference&lt;/a&gt;  &lt;li&gt;&lt;a href="http://groups.google.de/group/microsoft.public.win32.programmer.wmi/msg/4c8f5dc43ddfeb21" rel="previewlink"&gt;Registering the Microsoft FTP service in WMI&lt;/a&gt;  &lt;li&gt;&lt;a href="http://www.ks-soft.net/hostmon.eng/wmi/index.htm" rel="previewlink"&gt;WMI Explorer&lt;/a&gt;, a tool that helps you find the right WMI&amp;nbsp;management class&amp;nbsp;and test your queries  &lt;li&gt;&lt;a href="http://www.ireasoning.com/mibbrowser.shtml" rel="previewlink"&gt;iReasoning MIB Browser&lt;/a&gt;, an SNMP GUI to explore and query a&amp;nbsp;SNMP server  &lt;li&gt;Microsoft's &lt;a href="http://wsman.msft.net/" rel="previewlink"&gt;WS-Management test server&lt;/a&gt; with &lt;a href="http://snmpboy.msft.net/pub/mrtg.cfg.txt" rel="previewlink"&gt;MRTG examples&lt;/a&gt;  &lt;li&gt;A sample &lt;abbr title="Windows Scripting Host"&gt;WSH&lt;/abbr&gt; script to query HTTP connections&lt;br&gt;&lt;pre&gt;Set&lt;/span&gt; wmiService = GetObject(&lt;span style="color: #006080"&gt;"winmgmts:root\cimv2"&lt;/span&gt;)

query = &lt;span style="color: #006080"&gt;"SELECT AnonymousUsersPersec, NonAnonymousUsersPersec FROM Win32_PerfRawData_W3SVC_WebService WHERE Name='_Total'"&lt;/span&gt;

&lt;span style="color: #0000ff"&gt;For&lt;/span&gt; &lt;span style="color: #0000ff"&gt;Each&lt;/span&gt; data &lt;span style="color: #0000ff"&gt;In&lt;/span&gt; wmiService.ExecQuery(query)
    &lt;span style="color: #0000ff"&gt;For&lt;/span&gt; &lt;span style="color: #0000ff"&gt;Each&lt;/span&gt; &lt;span style="color: #0000ff"&gt;property&lt;/span&gt; &lt;span style="color: #0000ff"&gt;in&lt;/span&gt; data.Properties_
        &lt;span style="color: #0000ff"&gt;If&lt;/span&gt; &lt;span style="color: #0000ff"&gt;property&lt;/span&gt;.Name = &lt;span style="color: #006080"&gt;"AnonymousUsersPersec"&lt;/span&gt; &lt;span style="color: #0000ff"&gt;Then&lt;/span&gt;
            anonymous = &lt;span style="color: #0000ff"&gt;property&lt;/span&gt;.Value
        &lt;span style="color: #0000ff"&gt;ElseIf&lt;/span&gt; &lt;span style="color: #0000ff"&gt;property&lt;/span&gt;.Name = &lt;span style="color: #006080"&gt;"NonAnonymousUsersPersec"&lt;/span&gt; &lt;span style="color: #0000ff"&gt;Then&lt;/span&gt;
            authenticated = &lt;span style="color: #0000ff"&gt;property&lt;/span&gt;.Value
        &lt;span style="color: #0000ff"&gt;End&lt;/span&gt; &lt;span style="color: #0000ff"&gt;If&lt;/span&gt;
    &lt;span style="color: #0000ff"&gt;Next&lt;/span&gt;
&lt;span style="color: #0000ff"&gt;Next&lt;/span&gt;

wmiService = null

WScript.Echo anonymous
WScript.Echo authenticated

WScript.Echo &lt;span style="color: #0000ff"&gt;Date&lt;/span&gt;() &amp;amp; &lt;span style="color: #006080"&gt;" "&lt;/span&gt; &amp;amp; Time()
WScript.Echo &lt;span style="color: #006080"&gt;"HTTPConnections"&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p class="now-playing"&gt;Now Playing [&lt;a title="Insert Now Playing into Your Own Blog Posts" href="http://www.it99.org/axl/Projects/NowPlaying/" rel="previewlink"&gt;?&lt;/a&gt;]: &lt;a title="Display Relations of Koop to Other Artists" href="http://www.music-map.de/koop.html"&gt;Koop&lt;/a&gt; – &lt;a title="Display Amazon Page of the Koop Islands Album" href="http://www.amazon.com/exec/obidos/ASIN/B000NQPXPI/therightstu0e-20"&gt;Koop Islands&lt;/a&gt; – &lt;a title="Preview Let's elope on Last.fm" href="http://www.last.fm/music/Koop/_/Let's+elope/"&gt;Let's elope&lt;/a&gt;&lt;/p&gt;</Content>
      <Created>2007-04-06T17:18:23.8437500+02:00</Created>
      <Modified>2007-04-06T19:12:01.5781250+02:00</Modified>
      <EntryId>66207d15-6a5a-44c9-996f-839c038a2edd</EntryId>
      <Title>Monitoring Servers</Title>
      <Categories>Networking</Categories>
      <Author>agross</Author>
      <IsPublic>true</IsPublic>
      <Syndicated>true</Syndicated>
      <ShowOnFrontPage>true</ShowOnFrontPage>
      <AllowComments>true</AllowComments>
      <Attachments />
      <Crossposts />
    </Entry>
  </Entries>
</DayEntry>